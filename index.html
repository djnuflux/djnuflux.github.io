<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BugBot Leaderboards</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 24px; }
    h1 { margin: 0 0 16px; }
    .wrap { display: grid; gap: 28px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; box-shadow: 0 1px 4px rgba(0,0,0,.05); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 8px; border-bottom: 1px solid #eee; text-align: left; }
    th { cursor: pointer; position: sticky; top: 0; background: #fafafa; }
    .muted { color: #666; font-size: 12px; }
    .pill { display:inline-block; padding:2px 8px; border-radius: 999px; background:#f3f4f6; font-size:12px; }
  </style>
</head>
<body>
  <h1>BugBot Leaderboards</h1>
  <p class="muted">Auto-generated from your BugBot SQLite database.</p>
  <div class="wrap">
    <div class="card">
      <h2>Top Catches</h2>
      <table id="top-catches">
        <thead><tr>
          <th data-k="username">User</th>
          <th data-k="total_catches" data-n>Catch Count</th>
          <th data-k="level" data-n>Level</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Top Levels</h2>
      <table id="top-levels">
        <thead><tr>
          <th data-k="username">User</th>
          <th data-k="level" data-n>Level</th>
          <th data-k="xp" data-n>XP (0â€“1)</th>
          <th data-k="total_catches" data-n>Catches</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Biggest by Species</h2>
      <table id="biggest">
        <thead><tr>
          <th data-k="species">Species</th>
          <th data-k="size_mm" data-n>Size (mm)</th>
          <th data-k="username">User</th>
        </tr></thead>
        <tbody></tbody>
      </table>
      <p class="muted">Shows the largest recorded size per species.</p>
    </div>
  </div>

  <script>
    const DATA_URL = 'data/leaderboard.json'; // committed by your export script

    function renderTable(id, rows, columns) {
      const tbody = document.querySelector(`#${id} tbody`);
      tbody.innerHTML = '';
      rows.forEach(r => {
        const tr = document.createElement('tr');
        columns.forEach(k => {
          const td = document.createElement('td');
          td.textContent = (r[k] ?? '');
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function attachSort(tableId, rows, columns) {
      const table = document.getElementById(tableId);
      const ths = table.querySelectorAll('th');
      ths.forEach((th, i) => {
        th.addEventListener('click', () => {
          const key = th.dataset.k;
          const numeric = th.hasAttribute('data-n');
          const dir = th.dataset.dir === 'asc' ? 'desc' : 'asc';
          ths.forEach(t => t.removeAttribute('data-dir'));
          th.setAttribute('data-dir', dir);
          rows.sort((a,b) => {
            const A = a[key] ?? (numeric ? 0 : '');
            const B = b[key] ?? (numeric ? 0 : '');
            return (A === B ? 0 : (A > B ? 1 : -1)) * (dir === 'asc' ? 1 : -1);
          });
          renderTable(tableId, rows, columns);
        });
      });
    }

    async function main() {
      const res = await fetch(DATA_URL, {cache: 'no-store'});
      const data = await res.json();

      const topCatches = data.top_catches || [];
      renderTable('top-catches', topCatches, ['username','total_catches','level']);
      attachSort('top-catches', topCatches, ['username','total_catches','level']);

      const topLevels = data.top_levels || [];
      renderTable('top-levels', topLevels, ['username','level','xp','total_catches']);
      attachSort('top-levels', topLevels, ['username','level','xp','total_catches']);

      const biggest = data.biggest_by_species || [];
      renderTable('biggest', biggest, ['species','size_mm','username']);
      attachSort('biggest', biggest, ['species','size_mm','username']);
    }

    main();
  </script>
</body>
</html>
